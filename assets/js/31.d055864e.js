(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{644:function(t,a,s){"use strict";s.r(a);var e=s(6),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"centos7安装jenkins和gitlab踩坑记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#centos7安装jenkins和gitlab踩坑记"}},[t._v("#")]),t._v(" centos7安装jenkins和gitlab踩坑记")]),t._v(" "),s("h2",{attrs:{id:"一、背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、背景"}},[t._v("#")]),t._v(" 一、背景")]),t._v(" "),s("ul",[s("li",[t._v("主机:win10")]),t._v(" "),s("li",[t._v("虚拟机:centos7")]),t._v(" "),s("li",[t._v("目标：成功安装gitlab&jenkins，并且可以正常利用gitlab的push event webhook触发jenkins的自动构建任务。")])]),t._v(" "),s("h2",{attrs:{id:"二、安装gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、安装gitlab"}},[t._v("#")]),t._v(" 二、安装gitlab")]),t._v(" "),s("p",[t._v("首先要在CentOS系统上面安装所需的依赖：ssh、防火墙、postfix(用于邮件通知)、wegt，以下这些命令也会打开系统防火墙中的HTTP和SSH端口访问。")]),t._v(" "),s("h3",{attrs:{id:"安装ssh协议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装ssh协议"}},[t._v("#")]),t._v(" 安装ssh协议")]),t._v(" "),s("blockquote",[s("p",[t._v("安装命令: yum install -y curl policycoreutils-python openssh-server")])]),t._v(" "),s("h3",{attrs:{id:"设置ssh服务开机自启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置ssh服务开机自启动"}},[t._v("#")]),t._v(" 设置ssh服务开机自启动")]),t._v(" "),s("blockquote",[s("p",[t._v("安装命令: ystemctl enable sshd")])]),t._v(" "),s("h3",{attrs:{id:"启动ssh服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动ssh服务"}},[t._v("#")]),t._v(" 启动ssh服务")]),t._v(" "),s("blockquote",[s("p",[t._v("启动命令: systemctl start sshd")])]),t._v(" "),s("h3",{attrs:{id:"安装防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装防火墙"}},[t._v("#")]),t._v(" 安装防火墙")]),t._v(" "),s("blockquote",[s("p",[t._v("安装命令: yum install firewalld systemd -y")])]),t._v(" "),s("h3",{attrs:{id:"开启防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启防火墙"}},[t._v("#")]),t._v(" 开启防火墙")]),t._v(" "),s("blockquote",[s("p",[t._v("开启命令: service firewalld  start")])]),t._v(" "),s("h3",{attrs:{id:"添加http服务到firewalld"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加http服务到firewalld"}},[t._v("#")]),t._v(" 添加http服务到firewalld")]),t._v(" "),s("blockquote",[s("p",[t._v("命令: firewall-cmd --permanent --add-service=http, pemmanent表示永久生效，若不加--permanent系统下次启动后就会失效。")])]),t._v(" "),s("h3",{attrs:{id:"重启防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启防火墙"}},[t._v("#")]),t._v(" 重启防火墙")]),t._v(" "),s("blockquote",[s("p",[t._v("重启命令: systemctl reload firewalld")])]),t._v(" "),s("h3",{attrs:{id:"安装postfix以发送邮件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装postfix以发送邮件"}},[t._v("#")]),t._v(" 安装Postfix以发送邮件")]),t._v(" "),s("blockquote",[s("p",[t._v("安装命令: yum install postfix")])]),t._v(" "),s("h3",{attrs:{id:"将postfix服务设置成开机自启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将postfix服务设置成开机自启动"}},[t._v("#")]),t._v(" 将postfix服务设置成开机自启动")]),t._v(" "),s("blockquote",[s("p",[t._v("命令: systemctl enable postfix")])]),t._v(" "),s("h3",{attrs:{id:"启动postfix"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动postfix"}},[t._v("#")]),t._v(" 启动postfix")]),t._v(" "),s("blockquote",[s("p",[t._v("启动命令: systemctl start postfix")])]),t._v(" "),s("h3",{attrs:{id:"安装wget-用于从外网上下载插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装wget-用于从外网上下载插件"}},[t._v("#")]),t._v(" 安装wget，用于从外网上下载插件")]),t._v(" "),s("blockquote",[s("p",[t._v("安装命令: yum -y install wget")])]),t._v(" "),s("h3",{attrs:{id:"下载gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载gitlab"}},[t._v("#")]),t._v(" 下载gitlab")]),t._v(" "),s("blockquote",[s("p",[t._v("命令: wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm")])]),t._v(" "),s("h3",{attrs:{id:"安装gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab"}},[t._v("#")]),t._v(" 安装Gitlab")]),t._v(" "),s("blockquote",[s("p",[t._v("命令: rpm -ivh gitlab-ce-10.5.7-ce.0.el7.x86_64.rpm")])]),t._v(" "),s("h3",{attrs:{id:"修改gitlab配置文件指定服务器ip和自定义端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改gitlab配置文件指定服务器ip和自定义端口"}},[t._v("#")]),t._v(" 修改gitlab配置文件指定服务器ip和自定义端口")]),t._v(" "),s("blockquote",[s("p",[t._v("vim  /etc/gitlab/gitlab.rb,修改默认端口到9000")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230528.jpg",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("配置时区: gitlab_rails['time_zone'] = 'Asia/Shanghai'")])]),t._v(" "),s("h3",{attrs:{id:"将9000端口添加到防火墙中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将9000端口添加到防火墙中"}},[t._v("#")]),t._v(" 将9000端口添加到防火墙中")]),t._v(" "),s("blockquote",[s("p",[t._v("命令: firewall-cmd --zone=public --add-port=9000/tcp --permanent")])]),t._v(" "),s("h3",{attrs:{id:"重启防火墙-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启防火墙-2"}},[t._v("#")]),t._v(" 重启防火墙")]),t._v(" "),s("blockquote",[s("p",[t._v("重启命令: systemctl reload firewalld")])]),t._v(" "),s("h3",{attrs:{id:"重置gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重置gitlab"}},[t._v("#")]),t._v(" 重置gitlab")]),t._v(" "),s("blockquote",[s("p",[t._v("命令: gitlab-ctl reconfigure")])]),t._v(" "),s("h3",{attrs:{id:"启动gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动gitlab"}},[t._v("#")]),t._v(" 启动gitlab")]),t._v(" "),s("blockquote",[s("p",[t._v("命令：gitlab-ctl restart")])]),t._v(" "),s("h3",{attrs:{id:"访问gitlab页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问gitlab页面"}},[t._v("#")]),t._v(" 访问gitlab页面")]),t._v(" "),s("blockquote",[s("p",[t._v("在浏览器里面直接输入服务器IP和指定的端口号就可以进行访问，第一次登陆的时候会默认进入修改密码界面。默认用户是root。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230554.jpg",alt:""}})]),t._v(" "),s("p",[t._v("到这gitlab就算安装成功啦，接下来就是")]),t._v(" "),s("h3",{attrs:{id:"新建项目-建一个readme-写点东西"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建项目-建一个readme-写点东西"}},[t._v("#")]),t._v(" 新建项目(建一个readme,写点东西)")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230612.jpg",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"生成ssh-key-这又出事啦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成ssh-key-这又出事啦"}},[t._v("#")]),t._v(" 生成ssh key(这又出事啦)")]),t._v(" "),s("p",[t._v("(主机和虚拟机要互相ping的通才可以下面的操作)")]),t._v(" "),s("p",[t._v('本来正常的生成ssh key：ssh-keygen -t rsa -C "admin@example.com"')]),t._v(" "),s("blockquote",[s("p",[t._v("注意：新建了gitlab的账户,默认的邮箱就是admin@example.com，可以添加自己的邮箱，然后gitlab会发送一封确认邮件，确认一下就可以啦。")])]),t._v(" "),s("p",[t._v("接着说，上面生成ssh key的命令我是在windows上执行的，但是之前生成过一次ssh key(绑定的是公司的邮箱，也默认放在.ssh下面)。遇到的第一个问题就是:以前都是enter几下就完事，但是这次失败啦，最后会问一句是否覆盖.ssh下面的公钥和私钥，默认是no。所以，enter之后，并没有生成新的公钥和私钥。然后在.ssh同级目录下新建.ssh_test目录，在目录中新建2个文件id_rsa以及id_rsa.pub。然后再生成ssh key的时候把.ssh_test的路径填写在")]),t._v(" "),s("blockquote",[s("p",[t._v("Enter file in which to save the key (/c/Users/xxxx/.ssh/id_rsa):")])]),t._v(" "),s("p",[t._v("即可。")]),t._v(" "),s("p",[t._v("终于ssh key生成成功啦，到gitlab的settings -> SSH Keys 添加公钥。")]),t._v(" "),s("p",[t._v("然后试着克隆一下吧(又出问题啦0.0)")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230640.jpg",alt:""}})]),t._v(" "),s("p",[t._v("一直要求输入密码。在网上查了一下原因：ssh-agent服务没把新产生的id_rsa包含进去。解决办法：")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v('eval "$(ssh-agent -s)"')]),t._v(" "),s("li",[t._v("ssh-add 新id_rsa的路径 如:ssh-add /c/Users/xxxx/.ssh_test/id_rsa")])])]),t._v(" "),s("p",[t._v("这个时候git clone git@192.168.198.129:root/test_jenkins.git ./test_jenkins就ok啦！！")]),t._v(" "),s("p",[t._v("这样gitlab就安装成功并且可以正常使用的。")]),t._v(" "),s("h2",{attrs:{id:"三、安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、安装jenkins"}},[t._v("#")]),t._v(" 三、安装jenkins")]),t._v(" "),s("h3",{attrs:{id:"首先要先安装java环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#首先要先安装java环境"}},[t._v("#")]),t._v(" 首先要先安装java环境")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.oracle.com/java/technologies/javase-jdk8-downloads.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载jdk"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230713.jpg",alt:""}})]),t._v(" "),s("p",[t._v("我在主机上下载的，然后用xftp传到虚拟机。")]),t._v(" "),s("h4",{attrs:{id:"创建安装目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建安装目录"}},[t._v("#")]),t._v(" 创建安装目录")]),t._v(" "),s("blockquote",[s("p",[t._v("mkdir /usr/local/java")])]),t._v(" "),s("h4",{attrs:{id:"解压至安装目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解压至安装目录"}},[t._v("#")]),t._v(" 解压至安装目录")]),t._v(" "),s("blockquote",[s("p",[t._v("tar -zxvf jdk-8u251-linux-x64.tar.gz -C /usr/local/java")])]),t._v(" "),s("h4",{attrs:{id:"设置环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置环境变量"}},[t._v("#")]),t._v(" 设置环境变量")]),t._v(" "),s("blockquote",[s("p",[t._v("vim /etc/profile")])]),t._v(" "),s("p",[t._v("在末尾添加")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230756.jpg",alt:""}})]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JAVA_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/java/jdk1.8.0_251\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JRE_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JAVA_HOME}")]),t._v("/jre\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLASSPATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(".:"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JAVA_HOME}")]),t._v("/lib:"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JRE_HOME}")]),t._v("/lib\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JAVA_HOME}")]),t._v("/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("使环境变量生效：")]),t._v(" "),s("blockquote",[s("p",[t._v("source /etc/profile")])]),t._v(" "),s("p",[t._v("添加软连接")]),t._v(" "),s("blockquote",[s("p",[t._v("ln -s /usr/local/java/jdk1.8.0_251/bin/java /usr/bin/java")])]),t._v(" "),s("p",[t._v("检查一下:")]),t._v(" "),s("blockquote",[s("p",[t._v("java -version")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230825.jpg",alt:""}})]),t._v(" "),s("p",[t._v("这样就ok啦。")]),t._v(" "),s("h3",{attrs:{id:"下载jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载jenkins"}},[t._v("#")]),t._v(" 下载jenkins")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://pkg.jenkins.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("各个版本的jenkins"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("建议下载最新的，我也是在主机上下载的然后xftp传到虚拟机上的。jenkins-2.222.3-1.1.noarch.rpm,我下载的这个版本。")]),t._v(" "),s("h3",{attrs:{id:"安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins"}},[t._v("#")]),t._v(" 安装jenkins")]),t._v(" "),s("blockquote",[s("p",[t._v("rpm -ivh jenkins-2.222.3-1.1.noarch.rpm")])]),t._v(" "),s("h3",{attrs:{id:"配置端口及权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置端口及权限"}},[t._v("#")]),t._v(" 配置端口及权限")]),t._v(" "),s("blockquote",[s("p",[t._v("vim /etc/sysconfig/jenkins")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230849.jpg",alt:""}})]),t._v(" "),s("p",[t._v("然后")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改目录权限")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R root:root /var/lib/jenkins\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R root:root /var/cache/jenkins\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R root:root /var/log/jenkins\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("重启一下：")]),t._v(" "),s("blockquote",[s("p",[t._v("service jenkins restart")])]),t._v(" "),s("h3",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),s("blockquote",[s("p",[t._v("systemctl start jenkins")])]),t._v(" "),s("p",[t._v("遇到的问题:")]),t._v(" "),s("ol",[s("li",[t._v("启动之后，查看状态systemctl status jenkins，发现不是正常的active (running), 而是active(exited)。 "),s("strong",[t._v("解决办法：")]),t._v(" 将8000端口添加到防火墙firewall-cmd --zone=public --add-port=8000/tcp --permanent")])]),t._v(" "),s("h3",{attrs:{id:"访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问"}},[t._v("#")]),t._v(" 访问")]),t._v(" "),s("p",[t._v("访问jenkins地址 http:<ip或者域名>:8000")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230919.jpg",alt:""}})]),t._v(" "),s("p",[t._v("执行命令 "),s("em",[t._v("cat /var/lib/jenkins/secrets/initialAdminPassword")]),t._v(" 查看密码，然后插件安装选择推荐插件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017230949.jpg",alt:""}})]),t._v(" "),s("p",[t._v("在这可能等的时间会比较久，如果有安装失败的也可以选择continue,去创建一个用户。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231005.jpg",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"安装需要的插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装需要的插件"}},[t._v("#")]),t._v(" 安装需要的插件")]),t._v(" "),s("p",[t._v("首先要更新插件源，因为官方的插件源安装起来很慢 还容易失败。")]),t._v(" "),s("p",[t._v("升级的源:https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/2.222/update-center.json")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231023.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231057.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231118.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231138.jpg",alt:""}})]),t._v(" "),s("p",[t._v("jenkins系统管理下的插件管理，在线安装Gitlab Hook Plugin和Gitlab Plugin这两个插件，然后叫重启jenkins。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231208.jpg",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"系统配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统配置"}},[t._v("#")]),t._v(" 系统配置")]),t._v(" "),s("p",[t._v("在manager jenkins中选择configure System,找到gitlab,设置好Gitlab的参数，并测试时候能连接上Gitlab")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231253.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231310.jpg",alt:""}})]),t._v(" "),s("p",[t._v("API token可以在gitlab中的用户的设置中找到")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231329.jpg",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"新建任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建任务"}},[t._v("#")]),t._v(" 新建任务")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231352.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231411.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231428.jpg",alt:""}})]),t._v(" "),s("p",[t._v("这个priviate Key就是一开始生成id_rsa私钥。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231447.jpg",alt:""}})]),t._v(" "),s("p",[t._v("在这选的触发条件按是push后触发。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231520.jpg",alt:""}})]),t._v(" "),s("p",[t._v("这个是构建时要执行的脚本，主要看看是否成功。")]),t._v(" "),s("p",[t._v("复制一下GitLab webhook URL,在这还有一个高级选项，点开然后去生成一个Secret token，这两个在gitlab中要用到。")]),t._v(" "),s("h2",{attrs:{id:"四、配置gitlab-webhook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、配置gitlab-webhook"}},[t._v("#")]),t._v(" 四、配置gitlab webhook")]),t._v(" "),s("p",[t._v("进去项目的settings-integrations")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231547.jpg",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231606.jpg",alt:""}})]),t._v(" "),s("p",[t._v("然后点击add webhook。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231618.jpg",alt:""}})]),t._v(" "),s("p",[t._v("测试一下：选择test下面的push event。")]),t._v(" "),s("p",[t._v("按道理来说应该是触发成功然后再jenkins中也可以看到构建,但是gitlab直接500啦。(0.0)")]),t._v(" "),s("p",[t._v("了解了一下，gitlab默认是不允许来自钩子的本地网络的请求的。")]),t._v(" "),s("p",[t._v("解决办法参考这两篇文章：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://gitlab.com/gitlab-org/gitlab-foss/-/issues/44480",target:"_blank",rel:"noopener noreferrer"}},[t._v("Integrations Webhooks not working - Error 500"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://gitlab.com/gitlab-org/omnibus-gitlab/-/issues/3307#note_64245578",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webhook does not work for me when i update to date!"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("我直接把办法也说了吧，就是：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231645.jpg",alt:""}})]),t._v(" "),s("p",[t._v("然后测试一下，ok啦")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231701.jpg",alt:""}})]),t._v(" "),s("p",[t._v("去jenkins看看")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20201017231726.jpg",alt:""}})]),t._v(" "),s("p",[t._v("over!!!!!")]),t._v(" "),s("p",[t._v("稍等，下一步计划——pipeline and jenkinsfile")]),t._v(" "),s("h2",{attrs:{id:"五、参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、参考文章"}},[t._v("#")]),t._v(" 五、参考文章")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/weixin_41782053/article/details/101016090",target:"_blank",rel:"noopener noreferrer"}},[t._v("centos7安装gitlab并配置汉化"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://my.oschina.net/lieefu/blog/469337",target:"_blank",rel:"noopener noreferrer"}},[t._v("ssh链接git服务器，解决push pull要求输入密码问题"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/fangts/p/11095316.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CentOS 7 安装 Jenkins"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.jianshu.com/p/2b2c204dcbe2",target:"_blank",rel:"noopener noreferrer"}},[t._v("利用gitlab的webhook触发jenkins"),s("OutboundLink")],1)])]),t._v(" "),s("comment")],1)}),[],!1,null,null,null);a.default=r.exports}}]);